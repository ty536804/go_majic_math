{{define "nav/index.html"}}
{{template "header"}}
<body>
<div class="x-nav">
          <span class="layui-breadcrumb">
            <a href="">首页</a>
            <a href="">导航管理</a>
            <a>
              <cite>导航列表</cite></a>
          </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="刷新">
        <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i></a>
</div>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header">
                    <button class="layui-btn"  id="btn" data-toggle="modal" data-target="#myModal2">
                        <i class="layui-icon"></i>添加</button>
                </div>
                <div class="layui-card-body ">
                    <table class="layui-table layui-form">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>名称</th>
                            <th>跳转地址</th>
                            <th>是否展示</th>
                            <th>操作</th>
                        </thead>
                        <tbody class="tbody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal inmodal" id="myModal2" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated bounceInRight">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">导航管理</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal m-t" id="addform">
                    <div class="form-group">
                        <input id="id" name="id" type="hidden" value="">
                        <label class="col-sm-3 control-label">名称：</label>
                        <div class="col-sm-8">
                            <input id="name" name="name"  type="text" class="form-control" value="">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">跳转地址：</label>
                        <div class="col-sm-8">
                            <input id="base_url" name="base_url" type="text" class="form-control" value="">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-3 control-label">状态：</label>
                        <div class="radio i-checks">
                            <label>
                                <input type="radio" value="1" checked name="is_show" id="is_show"> <i></i> 正常</label>
                            <label>
                                <input type="radio" value="2" name="is_show" id="is_show"><i></i> 禁用</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" type="button" id="addpower" name="addpower">提交</button>
                <button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
</body>
<script type="application/javascript">
    getAjax()
    //请求数据
    function getAjax()
    {
        $.ajax({
            type: "GET",
            dataType: "json",
            url: "/api/v1/getNavs",
            success: function (result) {
                let _html= "";
                if (Number(result.code) == 200) {
                    $.each(result.data,function (k,v) {
                        _html += "<tr><td>"+v.id+"</td><td>"+v.name+"</td><td>"+v.base_url+"</td>"
                        _html += "<td>"+(Number(v.is_show)==1 ? '启用' : '禁用')+"</td>"
                        _html += '<td class="td-manage">' +
                            '<a title="编辑" onclick="member_restore('+v.id+')" href="javascript:;"><i class="fa fa-pencil-square-o" aria-hidden="true"></i>编辑</a>\n' +
                            '</td></tr>';
                    })
                } else {
                    _html = "<tr><td colspan='5' class='text-center'>暂无内容</td></tr>"
                }
                $(".tbody").empty().append(_html)
            }
        });
    }
    $("#addpower").on("click", function () {
        if ($("#addform #name").val() == "") {
            sweetAlert("登录失败","名称不能为空",'error');
            return false;
        }
        if ($("#addform #base_url").val() == "") {
            sweetAlert("登录失败","跳转地址不能为空",'error');
            return false;
        }
        $.ajax({
            type: "POST",
            dataType: "json",
            url: "/api/v1/addNav",
            data: $("#addform").serialize(),
            success: function (result) {
                if (Number(result.code) == 200) {
                    swal({title:"操作成功",type: 'success'},
                        function () {
                            // $("#myModal2").modal('hide');
                            window.location.reload();
                        });
                } else {
                    sweetAlert("操作失败",result.msg,'error');
                }
            },
            error: function (result) {
                $.each(result.responseJSON.errors, function (k, val) {
                    sweetAlert("操作失败",val[0],'error');
                    return false;
                });
            }
        });
        return false;
    })

    //查看当个用户信息
    function member_restore(id) {
        $.ajax({
            type: "POST",
            dataType: "json",
            url: "/api/v1/getNav",
            data: {"id":id},
            success: function (result) {
                if (Number(result.code) == 200) {
                    $("#addform #id").val(result.data.id)
                    $("#addform #name").val(result.data.name)
                    $("#addform #base_url").val(result.data.base_url)
                    if (Number(result.data.is_show) ==1) {
                        $('input[type="radio"]:eq(0)').prop("checked",true);
                    } else {
                        $('input[type="radio"]:eq(1)').prop("checked",true);
                    }
                    $("#myModal2").modal("show");
                } else {
                    initInput()
                }
            }
        });
    }
</script>
</html>
{{end}}